<!DOCTYPE html>
<html><head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0,user-scalable=no">
	<title>小米帐号</title>

	<link type="text/css" rel="stylesheet" href="__PUBLIC__/Home/css/reset.css">
	<link type="text/css" rel="stylesheet" href="__PUBLIC__/Home/css/layout.css">
	<link type="text/css" rel="stylesheet" href="__PUBLIC__/Home/css/modacctip.css">
	
	<script src="__PUBLIC__/Home/js/jquery-1.8.3.min.js" type="text/javascript"></script>
	<script src="__PUBLIC__/Home/js/ajaxfileupload.js" type="text/javascript"></script>

	<style type="text/css">
		/*启用修改头像功能*/
		.na-img-area:hover .na-edit{
			display:block;
			cursor: pointer;
		}
		.na-img-area{cursor:default}
		/*popup的遮层*/
		.popup_mask{
			position:fixed;
			z-index:99;
			width:100%;
			height:100%;
			left:0;
			top:0;
			display:none;
			_position:absolute;
			_height: 1000px;
		}
		.popup_mask .mod_wrap{
		    height: 100%;
		    overflow-y: auto;
		    position: absolute;
		    width: 100%;
		    z-index: 1;
		}
		.popup_mask .bkc{
			position:absolute;
			width:100%;
			height:200%;
			left:0;
			top:0;
			background-color:#333;
			filter: alpha(opacity=70);
			opacity:0.7;
		}
		.popup_mask .mod_acc_tip{
			display:none;
			position:absolute;
			left:50%;
			margin-left:-206px;
			top:50%;
			margin-top:-187px;
			_top: 500px;
		}
		/*剪切图片的水平、垂直居中及模糊*/
		.clipimg{
			text-align: left;
			position: relative;
		}
		.clipimg img{
			max-width:300px;
			max-height:300px;
			/*
			filter: alpha(opacity=70);
			opacity: .7;
			*/
			position: absolute;
		}
		/*clip部分*/
		.clipimg .movebox{
		/*
			background-position: 50% 50%;
			background-repeat: no-repeat;
			*/
			border: 1px solid #00aeff;
		}
		.uploadimgs{
			filter: none;
			opacity: 1;
		}
		.clipimg .movebox{
			width: 98px;
			height: 98px;
			z-index:1000;
			background-image:url(#);
		}
		.clipimg .icon_square_rightbot{
			cursor: se-resize;
			left: 100%;
		    margin-left: -4px;
		    margin-top: -4px;
		    top: 100%;
		}
		.n-logo-area {
		    height: 31px;
		    line-height: 31px;
		    padding: 50px 0;
		}

		.na-name {
		    color: #333;
		    font-size: 14px;
		    font-weight: bold;
		    line-height: 1.5;
		    overflow: hidden;
		    text-overflow: ellipsis;
		    white-space: nowrap;
		}
		/*上传*/
		#photoUploader .uplodefile{
			font-size: 45px;
			*vertical-align: bottom;
		}
		::-webkit-file-upload-button { cursor:pointer; }
		/*干掉该死的IE6的遮罩问题*/
		#loadingMask .bkc{
			_height:2000px;
		}
		/*wap*/
		.bugfix_ie6{ display:block;}	
		/*选项卡样式*/
		.hide{display:none;}
		.n-nav-corner{display:inline-block;}
		.n-nav-corner{width: 23px; height: 12px; margin-top:12px; margin-bottom:-2px;_margin-bottom:-5px; display: none; background: url(https://account.xiaomi.com/static/res/7c3e9b0/passport/acc-2014/img/n-layout-corner.png) 0 0 no-repeat;}
		.n-main-nav li.current .n-nav-corner{display: inline-block; *display: inline; *zoom:1;}
		.firsts{margin-top:30px;}
		/*修改头像*/
		.Tows,.Threes,.Fours{display:none;}
		/*生日选项隐藏*/
		.tits_list{display:none}
	</style>

</head>
<body style="overflow-y:scroll;" class="zh_CN">
	<div class="Ones" style="margin-left:195px;position:absolute;Z-index:1;">
		<div class="popup_mask" style="display: none;" id="loadingMask">
			<div class="bkc"></div>
			<div class="mod_wrap loadingmask">
			</div>
		</div>
		<!-- 小米账号页面头部区，logo 和 退出 start -->
		<div class="layout bugfix_ie6 dis_none">
	  		<div class="n-logo-area clearfix">
	    		<a href="https://account.xiaomi.com/" class="fl-l">
	      			<img src="__PUBLIC__/Home/image/n-logo.png">
	        	</a>
	    		<a id="logoutLink" class="fl-r logout" href="{:U('Home/AccountInfo/logout')}">退出</a>
	  		</div>
	  
		    <!--头像 名字 显示区start-->
			<div class="n-account-area-box">
				<div class="n-account-area clearfix">
				    <div class="na-info">
						<p class="na-name">
							<eq name="users['uid']" value="">请设置名字
							<else/>{$users['name'] ? $users['name'] : 请设置名字}</eq>
						</p>
						<p class="na-num">108264313</p>
				    </div>
				    <div class="na-img-area fl-l">
						<div class="na-img-bg-area">
							<img src="__PUBLIC__/{$user['img']}">
						</div>
				  	</div>
				</div>
			</div>
			<!--头像 名字 显示区end-->
	  	</div>
		<!-- 小米账号页面头部内容，logo 和 退出 end-->
		
		<!-- 小米账号页面内容区start -->
		<div class="layout">
			<!-- 选项卡列表标题start -->
	      	<div class="n-main-nav clearfix liebx">
	        	<ul>
		        	<li class="current selected">
			            <a href="#">个人信息</a>
			            <em class="n-nav-corner"></em>
		          	</li>
	          		<li>
	            		<a href="#">高级设置</a>
	            		<em class="n-nav-corner"></em>
	          		</li>
	        	</ul>
	      	</div>
			<!-- 选项卡列表标题start -->
			
			<!-- 选项卡内容展示区start -->
	      	<div class="n-frame device-frame">
				<div class="uinfo c_b">
	    			<div class="main_l">
	    				<!-- 用户头像设置区start -->
	      				<div class="naInfoImgBox t_c">
	        				<div class="na-img-area marauto">
	          					<div class="na-img-bg-area">
	            					<em class="na-edit" style="background:url('__PUBLIC__/upload/UserPortrait/sbydsj.png') "></em>
	            					<img src="__PUBLIC__/{$user['img']}">
								</div>
	        				</div>
	        				<div class="naImgLink">
			  					<a class="color4a9" href="" title="设置头像">设置头像</a>
	        				</div>
	      				</div>   
	    				<!-- 用户头像设置区end -->
	    			</div>

	    			<div class="main_r">
			        	<!-- 个人信息-基础资料start -->
			            <div class="framedatabox yincang">
			            	<div class="fdata firsts">
			              		<a class="color4a9 fr" href="#" title="编辑" id="editInfo"><i class="iconpencil"></i>编辑</a>
			              		<h3>基础资料</h3>    
			            	</div>
			            	<div class="fdata lblnickname">
			              		<p>
				              		<span>姓名：</span><span class="value" _empty="">
				              		<span>
										<eq name="users['uid']" value="">请设置名字
										<else/>{$users['name'] ? $users['name'] : 请设置名字}</eq>
				              		</span></span>
			              		</p>     
			         	    </div>
			            	<div class="fdata lblbirthday">
			              		<p>
				              		<span>生日：</span>
				              		<span class="value" _empty="">{$users['birthday']}</span>
				              	</p>     
			            	</div>
			            	<div class="fdata lblgender">
			              		<p>
				              		<span>性别：</span>
				              		<span class="value" _empty="">
					              		<eq name="users['uid']" value="">
					              		<else/>{$users['sex'] ? "男" : "女"}</eq>
				              		</span>
				              	</p>     
			            	</div>
						</div>
			        	<!-- 个人信息-基础资料end -->

			        	<!-- 高级设置start -->
						<div class="framedatabox yincang hide">
							<div class="fdata  firsts" style="margin-top:55px">
							  <h3>高级设置</h3>    
							</div>
							<!-- 银行卡 -->
							<div class="fdata click-row">
							  <a class="color4a9 fr" target="_blank" href="{:U('Home/AccountInfo/bankcard')}?name=<?php echo $users['name'] ? $users['name'] : 请设置名字; ?>" title="管理">管理</a>              
							  <p>
								<span>银行卡</span>					
								<span class="arrow_r"></span>
							  </p>     
							</div>
							<!-- 账号地区 -->
							<div class="fdata click-row">
							  <p>
								  <span>帐号地区：  </span>
								  <span><em id="region" _code="CN">中国</em><i class="arrow_r"></i></span>
							  </p>     
							</div>
						</div>
			        	<!-- 高级设置end -->
	    			</div>
	      		</div>
		 	</div>
			<!-- 选项卡内容展示区end -->

		</div>
		<!-- 小米账号页面内容区end -->

		<!-- 小米账号页面脚部区start -->
		<div class="n-footer">
	   		<div class="faq_link"><a class="a_critical" href="#" target="_blank"><em></em>常见问题</a></div>
	  		<p class="nf-intro"><span>小米公司版权所有-京ICP备10046444-京公网安备1101080212535</span></p>
	  		<div class="nf-link-area clearfix">
	  			<ul class="lang-select-list">
	    			<li><a class="current" href="javascript:void(0)" data-lang="zh_CN">简体</a>|</li>
				    <li><a href="javascript:void(0)" data-lang="zh_TW">繁体</a>|</li>
				    <li><a href="javascript:void(0)" data-lang="en">English</a></li>
	  			</ul>
	  		</div>
		</div>
		<!-- 小米账号页面内容区end -->
	</div>
	<script type="text/javascript">
		// 个人信息选项卡
		$(function(){
			// 获取元素
			var div_li = $('div.liebx ul li');
			// 绑定点击事件
			div_li.click(function(){
				//获取当前操作元素在同辈元素中的索引
				var index = div_li.index(this);
				$(this).children().css({color:'#ff7e00'});
				$(this).children('em').css('display','inline-block');
				$(this).siblings().children().css('color','black');
				$(this).siblings().children('em').css('display','none');

				// 显示该元素div，同时隐藏其他同辈元素对应的div
				$('div.yincang')
				.eq(index).show()//显示 <li>元素对应的<div>元素
				.siblings().hide();//隐藏其它几个同辈的<div>元素
			});
		});

		//个人头像
		$(function(){
			var image = $("em.na-edit");
			var Tows = $("div.Tows");
			var Threes = $("div.Threes");
			var bodys = $("body.zh_CN");
			image.click(function(){
				// 显示隐藏div
				Tows.css('display','block');
				Threes.css('display','block');
				//隐藏滚动条
				bodys.css('overflow-y','hidden');
			});
		});
	</script>


	<div class="Tows" style="width:100%;height:100%; overflow-y: auto;background:black;opacity:0.55;position:absolute;Z-index:2;"></div>

	<!-- 设置头像start -->
	<div class="Threes"  style="position:absolute;Z-index:3;">
		<div style="width:440px;height:330px;display: block;" class="mod_wrap mod_acc_tip layeruploadface">
	  		<div class="mod_tip_hd" style="width:412px;margin:14px;padding-top:0px">
		    	<h4>修改头像</h4>
		    	<a class="btn_mod_close" href="" title=""><span>关闭</span></a>
	  		</div>
	  		<div class="mod_tip_bd preupload" style="display:block;">
				<iframe style="display:none;" name="uploadPhoto" id="uploadPhoto" height="0" width="0"></iframe>
				<!-- 
			    <form action="/user/profile/requestUpload" method="POST">   
					<input type="hidden" name="userId" value="108264313">
					<input type="hidden" name="quality" value="1.0">
					<input type="hidden" name="isRedirect" value="true">
					<input type="hidden" name="passport_ph" value="">
					<input type="hidden" name="passToken" value="">
				</form> 
				 -->
				<form action="{:U('Home/AccountInfo/uploadimg')}" method="POST" enctype="multipart/form-data" target="uploadPhoto" id="photoUploader">   
	    		<div class="wapbox accset">
	      			<dl>
	        			<dt><strong class="wap_title_big">请上传图片：</strong></dt>
	        			<dd>
	          				<div class="uplode_img">
							  <!--
					            <a class="btn_tip btn_commom" href="" title="上传头像">上传头像</a>
								-->
								<input onclick="return false;" class="btn_tip btn_commom" value="上传头像" type="button">
	            				<input class="uplodefile" id="filel" name="userfile" onchange="uploadFile();" autocomplete="off" disableautocomplete="" type="file">
	          				</div>
	          				<p>jpg 或 png，大小不超过2M</p>
	        			</dd>              
	      			</dl>
	      			<div _text="图片格式不符合要求！" class="err_tip wng_fmt err_tip_independ" style="display:none;">图片格式不符合要求！</div>       
		  			<div _text="系统错误，请稍候再试" class="err_tip sys_err err_tip_independ" style="display:none;">系统错误，请稍候再试</div> 
		  			<div _text="文件太大，上传失败" class="err_tip file_too_large err_tip_independ" style="display:none;">文件太大，上传失败</div> 
	    		</div>      
	    		<div class="tip_btns">      
		      		<!-- <input class="btn_tip btn_commom" type="submit" value="保存"> -->
				    <a class="btn_tip btn_back" href="" title="取消">取消</a>
			    </div>
	    		</form> 
	  		</div> 
	  		<!-- 图片加载中 -->
	  		<div class="mod_tip_bd uploading" style="display: none;">  
				<div class="wapbox">
		    		<div class="mar30 t_c">
				      	<!-- loading图片 -->
				      	<img width="88" height="88" alt="" src="">
		      			<div class="naccprocess">
		        			<p style="display:none;" class="ft20"><span></span>%</p>
		        			<p>上传中</p>
		      			</div>
		    		</div>      
		    		<div style="display:none; margin-left:100px;" class="err_tip wng_fmt err_tip_independ" _text="图片格式不符合要求！">图片格式不符合要求！</div>       
					<div style="display:none; margin-left:100px;" class="err_tip file_too_large err_tip_independ" _text="文件太大，上传失败">文件太大，上传失败</div> 
					<div style="display:none;" class="err_tip sys_err uploaderror err_tip_independ" _text="系统错误，请稍候再试">系统错误，请稍候再试</div>
			  		<div style="display:none; margin-left:100px;" class="err_tip missing_param err_tip_independ" _text="缺少参数">缺少参数</div>
			  		<div style="display:none; margin-left:100px;" class="err_tip missing_file err_tip_independ" _text="找不到指定文件">找不到指定文件</div>
			  		<div style="display:none; margin-left:100px;" class="err_tip unsupported_mime_type err_tip_independ" _text="不支持的MIME TYPE">不支持的MIME TYPE</div>
				</div>
		    	<div class="tip_btns">      
			      	<!-- <input class="btn_tip btn_commom" type="submit" value="保存"> -->
			      	<a title="取消" href="" class="btn_tip btn_back" id="abortUpload">取消</a>
		    	</div>
		  	</div>
	  		<!-- 图片上传裁剪 -->
	  		<div class="mod_tip_bd uploaded" style="display: none;">
				<div class="wapbox">
					<div class="clipimg t_c bigdiv">
						<!-- 图片放置位置       -->
						<div class="uploadimgs">
							<img id="pic" alt="">
						</div>
						<div class="movebox" style="width: 100px; height: 100px; top: 100px; left: 100px;">
							<i class="flex icon_square icon_square_rightbot"></i>
						</div> 	
					</div>
					<div class="cliperror">
						<div style="display:none;" class="err_tip sys_err err_tip_independ" _text="系统错误，请稍候再试">系统错误，请稍候再试</div> 
						<div style="display:none;" class="err_tip bad_param err_tip_independ" _text="参数错误">参数错误</div> 
						<div style="display:none;" class="err_tip upload_failed err_tip_independ" _text="上传失败">上传失败</div> 
					</div>
				</div>
			    <div class="tip_btns">      
			      <input type="submit" value="确定" class="btn_tip btn_commom tijiao">
			      <a id="reuploadPhoto" title="重新上传" href="#" class="btn_tip btn_back">重新上传</a>
			    </div>
			</div>
		</div>
	</div>	
	<!-- 设置头像end -->

	<script type="text/javascript">
		//封装表单div.mod_acc_tip框移动居中函数
		function resizeyd(){
			//获取浏览器可视区域的宽、高
			var Width = $(window).width();
			var Height = $(window).height();
			//获取修改头像表单div.mod_acc_tip框宽、高mod_acc_tip
			var w = $('div.mod_acc_tip').width();
			var h = $('div.mod_acc_tip').height();
			//设置left、top
			var Left = (Width-w-1)/2 + 'px';
			var Top = (Height-h-41)/2 + 'px';
			//修改头像表单div.mod_acc_tip框位置
			$('div.mod_acc_tip').css({margin:'0px',padding:'0px',left:Left,top:Top})
		}
		resizeyd();
		// 绑定浏览器窗口大小调整事件
		$(window).resize(function(){resizeyd()});

		//上传图片，并在div中显示，使用$.ajaxfileupload
		//获取元素
		var layeruploadface = $('div.layeruploadface');
		var preupload = $('div.preupload');
		var uploading = $('div.uploading');
		var uploaded = $('div.uploaded');
		var pic = $('#pic');
		var  img = ""; //存储当前上传图片的路径
		var widths = "";
		var heights = "";
		var lefts = "";
		var tops = "";
		var imgold =  "./public/{$user['img']}";//获取、拼接原头像路径
		//声明uploadFile函数
		function uploadFile(){
			$.ajaxFileUpload({
				url: "{:U('Home/AccountInfo/uploadimg')}",//上传处理程序地址
				data:{shanchu:imgold}, //传递原头像路径参数
				type:'POST',  
				secureuri: false, // 是否启用安全提交，默认为false
				fileElementId: 'filel',//需要上传的文件域的ID
				dataType: 'json', //服务器返回的数据类型。可以为xml,script,json,html。如果不填写，jQuery会自动判断。
				//success 提交成功后自动执行的处理函数，参数data就是服务器返回的数据。
				success: function(data){
					layeruploadface.css('height','480px');
					preupload.css('display','none');
					uploaded.css('display','block');
					pic.attr('src','__ROOT__'+data.path);
					img = data.jtps;//当前上传图片地址
					widths = data.chicun[0]; //原图宽
					heights = data.chicun[1];//原图高
					if(widths > heights){
						tops = (150-(300*heights)/(2*widths));
						var top = tops+"px";//上偏移
						pic.css({width:'300px',marginTop:top});
					}else{
						lefts = (150-(300*widths)/(2*heights));
						left = lefts+"px";//左偏移
						pic.css({height:'300px',marginLeft:left});
					}
					
				}
			})
		}

		//div.movebox移动选择截取
		//获取div元素
		var bigdiv = $('div.bigdiv');
		var movebox = $('div.movebox');
		var newLeft = "100px";
		var newTop = "100px";
		var down = false; //检测鼠标按下变量
		//绑定鼠标按下事件
		movebox.mousedown(function(){
			down = true;
		})
		//绑定鼠标抬起事件
		movebox.mouseup(function(){
			down = false;
		})
	//div.movebox移动
		//绑定鼠标移动事件(div.movebox跟随鼠标移动)
		bigdiv.mousemove(function(e){
			//判断鼠标事件
			if(!down) return;

			//获取div偏移量与宽高
			var L = bigdiv.offset().left;
			var T = bigdiv.offset().top;
			var W = bigdiv.width();
			var H = bigdiv.height();
			var l = movebox.offset().left;
			var t = movebox.offset().top;
			var w = movebox.width();
			var h = movebox.height();

			//获取边界尺寸
			var minX = L+w/2+lefts;
			var maxX = L+W-w/2-lefts-2;
			var minY = T+h/2+tops;
			var maxY = T+H-h/2-tops-2;

			//获取鼠标left top 偏移量
			var x = e.clientX;
			var y = e.clientY;

			// //越界判断
			if(x <= minX){ x=minX; }
			if(x >= maxX){ x=maxX; }
			if(y <= minY){ y=minY; }
			if(y >= maxY){ y=maxY; }


			//计算movebox新的left top 
			newLeft = x-L-w/2;
			newTop = y-T-h/2;

			//设置movebox的 left top
			movebox.css({left:newLeft,top:newTop});
		})

		//i.flex 扩大缩小div.movebox
		//获取元素
		var flex = $('i.flex');
		var downs = false;//鼠标按下判断变量
		//鼠标按下、抬起事件
		flex.mousedown(function(){
			downs = true;
			return false;
		});
		bigdiv.mouseup(function(){
			downs = false;
			return false;
		});

	//div.movebox伸缩
		//绑定鼠标移动事件(div.movebox跟随鼠标移动伸缩)
		bigdiv.mousemove(function(e){
			//判断鼠标是否按下
			if(!downs) return false;
			// down = false;//解除div.movebox按下移动事件
			//获取div偏移量与宽高
			var L = bigdiv.offset().left;
			var T = bigdiv.offset().top;
			var W = bigdiv.width();
			var H = bigdiv.height();
			var l = movebox.offset().left;
			var t = movebox.offset().top;
			var w = movebox.width();
			var h = movebox.height();

			//获取鼠标left top 偏移量
			var x = e.clientX;
			var y = e.clientY;

			//判断、计算边界最值尺寸
			//如果图片宽度大于长度
			if(widths >= heights){
				var minX = L+100;
				var maxX = L+300-2*tops-2;
				var minY = T+tops+100;
				var maxY = T+300-tops-2; 
			}else{
				var minX = L+lefts+100;
				var maxX = L+300-lefts-2; 
				var minY = T+100;
				var maxY = T+300-2*lefts-2; 
			}
			


			//越界判断
			if(x <= minX){ x=minX;}
			if(x >= maxX){ x=maxX;}
			if(y <= minY){ y=minY;}
			if(y >= maxY){ y=maxY;}
			
			

			//计算movebox新的width height 
			var newW = x-l;
			var newH = y-t;
			if(newW >= newH && newW >= 100){
				var wh = newW +"px";
			}
			if(newH >= newW && newH >= 100){
				var wh = newH +"px";
			}
			if(newW < 100 && newH < 100){
				var wh = "100px";
			}

			//修改div.movebox 的width height大小
			$('div.movebox').css({width:wh,height:wh});
			
			return false;
		});

	// //div.movebox伸缩
	// 	//绑定鼠标移动事件(div.movebox跟随鼠标移动伸缩)
	// 	bigdiv.mousemove(function(e){
	// 		//判断鼠标是否按下
	// 		if(!downs) return false;
	// 		// down = false;//解除div.movebox按下移动事件
	// 		//获取div偏移量与宽高
	// 		var L = bigdiv.offset().left;
	// 		var T = bigdiv.offset().top;
	// 		var W = bigdiv.width();
	// 		var H = bigdiv.height();
	// 		var l = movebox.offset().left;
	// 		var t = movebox.offset().top;
	// 		var w = movebox.width();
	// 		var h = movebox.height();

	// 		//获取边界尺寸
	// 		var minX = L+w/2+lefts;
	// 		var maxX = L+W-w/2-lefts-2;
	// 		var minY = T+h/2+tops;
	// 		var maxY = T+H-h/2-tops-2;

	// 		//获取鼠标left top 偏移量
	// 		var x = e.clientX;
	// 		var y = e.clientY;

	// 		//越界判断
	// 		if(x <= minX){ x=minX; }
	// 		if(x >= maxX){ x=maxX; }
	// 		if(y <= minY){ y=minY; }
	// 		if(y >= maxY){ y=maxY; }

	// 		//计算movebox新的width heigh
	// 		var newW = x-l-w;
	// 		var newH = y-t-h;
	// 		if(newW >= newH && newW >= 0){
	// 			var wh = (100+(x-l-w))+"px";
	// 		}
	// 		if(newH >= newW && newH >= 0){
	// 			var wh = (100+(y-t-h))+"px";
	// 		}
	// 		if(newW < 0 && newH < 0){
	// 			var wh = "100px";
	// 		}

	// 		//设置movebox的 left top
	// 		// movebox.css({left:newLeft,top:newTop});

	// 		//修改div.movebox 的width height大小
	// 		$('div.movebox').css({width:wh,height:wh});
			
	// 		return false;
	// 	});

		// //图片裁剪
		var tijiao = $('input.tijiao');//获取提交元素
		var movebox = $('div.movebox');

		tijiao.click(function(){
			var imgsql = img;//裁剪后图片路径
			img = "./public/"+img; //获取要裁剪的图片路径
			//判断原图宽高，计算原图与等比例缩放图比例
			var bili = 1;
			if(widths >= heights){
				bili = widths/300;
			}else{
				bili = heights/300;
			}
			//获取、计算参数
			var width = (movebox.width())*bili;
			var height = (movebox.height())*bili;
			var left = (movebox.position().left)*bili;
			var top = (movebox.position().top)*bili;
			//判断偏移量
			if(widths >= heights){
				top = ((movebox.position().top) - (300-heights/bili)/2)*bili;
			}else{
				left = ((movebox.position().left) - (300-widths/bili)/2)*bili;
			}

			// if("{$detection}" == "no"){
				location.href = "{:U('Home/AccountInfo/tailor')}?img="+img+"&imgsql="+imgsql+"&width="+width+"&height="+height+"&left="+left+"&top="+top;
			// }

		});
	</script>

	<!-- 编辑基础资料start -->
	<div class="mod_acc_tip Fours" style="width:440px;height:370px;">
	  <div class="mod_tip_hd srs" style="width:410px;margin-left:15px;">
	    <h4>编辑基础资料</h4>
	    <a class="btn_mod_close" href="" title=""><span>关闭</span></a>
	  </div>
	  <div class="mod_tip_bd">
	    <form action="{:U('Home/AccountInfo/index')}" method="get">      
	    <div class="wapbox editbasicinfo">
	      <dl class="infobox c_b">
	        <dt>姓名：</dt>
	        <dd>
	          <label class="labelbox">
	          	<input class="nickname" name="username" maxlength="18" placeholder="姓名" type="text" value="<eq name="users['uid']" value="null">请设置名字<else/>{$users['name'] ? $users['name'] : ''}</eq>" id="usernames">
	          </label>
	        </dd>      
	        <dt>生日：</dt>
	        <dd class="sr">
	          	<ul class="c_b">
		            <li class="biry shengri">
		              <div>
		                <span class="titsbirth c_b nyr">
		                  <tt class="birthcon" id="years">{$year ? $year : "请选择"}</tt>
		                  <i class="iconbirth" style="background:url('__PUBLIC__/Home/image/icon_user.png');"></i>
		                </span>
		              </div>
		              <div class="tits_list riqi" as="">
						<p value="2015">2015</p>
						<p value="2014">2014</p>
						<p value="2013">2013</p>
						<p value="2012">2012</p>
						<p value="2011">2011</p>
						<p value="2010">2010</p>
						<p value="2009">2009</p>
						<p value="2008">2008</p>
						<p value="2007">2007</p>
						<p value="2006">2006</p>
						<p value="2005">2005</p>
						<p value="2004">2004</p>
						<p value="2003">2003</p>
						<p value="2002">2002</p>
						<p value="2001">2001</p>
						<p value="2000">2000</p>
						<p value="1999">1999</p>
						<p value="1998">1998</p>
						<p value="1997">1997</p>
						<p value="1996">1996</p>
						<p value="1995">1995</p>
						<p value="1994">1994</p>
						<p value="1993">1993</p>
						<p value="1992">1992</p>
						<p value="1991">1991</p>
						<p value="1990">1990</p>
						<p value="1989">1989</p>
						<p value="1988">1988</p>
						<p value="1987">1987</p>
						<p value="1986">1986</p>
						<p value="1985">1985</p>
						<p value="1984">1984</p>
						<p value="1983">1983</p>
						<p value="1982">1982</p>
						<p value="1981">1981</p>
						<p value="1980">1980</p>
						<p value="1979">1979</p>
						<p value="1978">1978</p>
						<p value="1977">1977</p>
						<p value="1976">1976</p>
						<p value="1975">1975</p>
						<p value="1974">1974</p>
						<p value="1973">1973</p>
						<p value="1972">1972</p>
						<p value="1971">1971</p>
						<p value="1970">1970</p>
						<p value="1969">1969</p>
						<p value="1968">1968</p>
						<p value="1967">1967</p>
						<p value="1966">1966</p>
						<p value="1965">1965</p>
						<p value="1964">1964</p>
						<p value="1963">1963</p>
						<p value="1962">1962</p>
						<p value="1961">1961</p>
						<p value="1960">1960</p>
						<p value="1959">1959</p>
						<p value="1958">1958</p>
						<p value="1957">1957</p>
						<p value="1956">1956</p>
						<p value="1955">1955</p>
						<p value="1954">1954</p>
						<p value="1953">1953</p>
						<p value="1952">1952</p>
						<p value="1951">1951</p>
						<p value="1950">1950</p>
						<p value="1949">1949</p>
						<p value="1948">1948</p>
						<p value="1947">1947</p>
						<p value="1946">1946</p>
						<p value="1945">1945</p>
						<p value="1944">1944</p>
						<p value="1943">1943</p>
						<p value="1942">1942</p>
						<p value="1941">1941</p>
						<p value="1940">1940</p>
						<p value="1939">1939</p>
						<p value="1938">1938</p>
						<p value="1937">1937</p>
						<p value="1936">1936</p>
						<p value="1935">1935</p>
						<p value="1934">1934</p>
						<p value="1933">1933</p>
						<p value="1932">1932</p>
						<p value="1931">1931</p>
						<p value="1930">1930</p>
						<p value="1929">1929</p>
						<p value="1928">1928</p>
						<p value="1927">1927</p>
						<p value="1926">1926</p>
						<p value="1925">1925</p>
						<p value="1924">1924</p>
						<p value="1923">1923</p>
						<p value="1922">1922</p>
						<p value="1921">1921</p>
						<p value="1920">1920</p>
						<p value="1919">1919</p>
						<p value="1918">1918</p>
						<p value="1917">1917</p>
						<p value="1916">1916</p>
						<p value="1915">1915</p>
						<p value="1914">1914</p>
						<p value="1913">1913</p>
						<p value="1912">1912</p>
						<p value="1911">1911</p>
						<p value="1910">1910</p>
						<p value="1909">1909</p>
						<p value="1908">1908</p>
						<p value="1907">1907</p>
						<p value="1906">1906</p>
						<p value="1905">1905</p>
						<p value="1904">1904</p>
						<p value="1903">1903</p>
						<p value="1902">1902</p>
						<p value="1901">1901</p>
						<p value="1900">1900</p>
		              </div>
		            </li>
	            	<li class="month_day birm shengri">              
	              		<div>
	                		<span class="titsbirth c_b nyr">
	                  			<tt class="birthcon" id="months">{$month ? $month : "请选择"}</tt>
	                  			<i class="iconbirth"  style="background:url('__PUBLIC__/Home/image/icon_user.png');"></i>
	                		</span>                  
	              		</div>
		              	<div class="tits_list riqi" id="yue" as="">
			                <p value="01">01</p>
			                <p value="02">02</p>
			                <p value="03">03</p>
			                <p value="04">04</p>
			                <p value="05">05</p>
			                <p value="06">06</p>
			                <p value="07">07</p>
			                <p value="08">08</p>
			                <p value="09">09</p>
			                <p value="10">10</p>
			                <p value="11">11</p>
			                <p value="12">12</p>
			            </div>
	            	</li>
	            	<li class="month_day bird shengri">                
			            <div>
			                <span class="titsbirth c_b nyr">
			                  <tt class="birthcon" id='days'>{$day ? $day : "请选择"}</tt>
			                  <i class="iconbirth" style="background:url('__PUBLIC__/Home/image/icon_user.png');"></i>
			                </span>                 
			            </div>
	              		<div class="tits_list bird riqi" as="">
			                <p value="01">01</p>
			                <p value="02">02</p>
			                <p value="03">03</p>
			                <p value="04">04</p>
			                <p value="05">05</p>
			                <p value="06">06</p>
			                <p value="07">07</p>
			                <p value="08">08</p>
			                <p value="09">09</p>
			                <p value="10">10</p>
			                <p value="11">11</p>
			                <p value="12">12</p>
			                <p value="13">13</p>
			                <p value="14">14</p>
			                <p value="15">15</p>
			                <p value="16">16</p>
			                <p value="17">17</p>
			                <p value="18">18</p>
			                <p value="19">19</p>
			                <p value="20">20</p>
			                <p value="21">21</p>
			                <p value="22">22</p>
			                <p value="23">23</p>
			                <p value="24">24</p>
			                <p value="25">25</p>
			                <p value="26">26</p>
			                <p value="27">27</p>
			                <p value="28">28</p>
			                <p value="29">29</p>
			                <p value="30">30</p>
			                <p value="31">31</p>
	              		</div>
	            	</li>
	            </ul>         
	        </dd>        
	        <dt>性别：</dt>
	        <dd class="infosex">
	          <span value="1" class='sexs'>
		          <i class="iconinfosex nan" style=" background: url('__PUBLIC__/Home/image/icon_user.png');background-position:30px 0;"></i>
		          <em>男</em>
	          </span>
	          <span value="0" class='sexs'>
		          <i class="iconinfosex nv" style="background:url('__PUBLIC__/Home/image/icon_user.png');background-position:30px 0;"></i>
		          <em>女</em>
	          </span>
	        </dd>
	      </dl>
	      <div _text="名字不能为空" class="err_tip empty_name err_tip_independ" style="display:none;">名字不能为空</div> 
		  <div _text="系统错误，请稍候再试" class="err_tip sys_err err_tip_independ" style="display:none;">系统错误，请稍候再试</div> 
		  <div _text="参数为空" class="err_tip empty_param err_tip_independ" style="display:none;">参数为空</div> 
		  <div _text="参数错误" class="err_tip bad_param err_tip_independ" style="display:none;">参数错误</div> 
		  <div _text="名字长度不合法，应为2-20个字符" class="err_tip bad_nickname err_tip_independ" style="display:none;">名字长度不合法，应为2-20个字符</div>
		  <div _text="生日格式不合法" class="err_tip bad_birthday err_tip_independ" style="display:none;">生日格式不合法</div>
		  <div _text="性别参数不合法" class="err_tip bad_gender err_tip_independ" style="display:none;">性别参数不合法</div>
	    </div>      
	    <div class="tip_btns srs">
	      <a class="btn_tip btn_commom baocun" href="#" title="保存">保存</a>
	      <!-- <input class="btn_tip btn_commom baocun" type="submit" value="保存"> -->
	      <a class="btn_tip btn_back" href="" title="取消">取消</a>
	    </div>
	    </form> 
	  </div>  
	</div>
	<script type="text/javascript">
		//获取编辑div
		var bianji = $('#editInfo');
		
		//绑定单击事件
		bianji.click(function(){
			var Tows = $("div.Tows");
			var Fours = $("div.Fours");
			Tows.css('display','block');
			Fours.css('display','block');
			//隐藏滚动条
			var bodys = $("body.zh_CN");
			bodys.css('overflow-y','hidden');
		});
		//封装表单div.mod_acc_tip框移动居中函数
		function resizeydbj(){
			//获取浏览器可视区域的宽、高
			var Width = $(window).width();
			var Height = $(window).height();
			//获取修改头像表单div.mod_acc_tip框宽、高mod_acc_tip
			var w = $('div.mod_acc_tip').width();
			var h = $('div.mod_acc_tip').height();
			//设置left、top
			var Left = (Width-w-1)/2 + 'px';
			var Top = (Height-h-41)/2 + 'px';
			//修改头像表单div.mod_acc_tip框位置
			$('div.mod_acc_tip').css({margin:'0px',padding:'0px',left:Left,top:Top})
		}
		resizeydbj();
		// 绑定浏览器窗口大小调整事件
		$(window).resize(function(){resizeydbj()});

		//生日
		var shengri = $('li.shengri .nyr');
		shengri.click(function(){
			$(this).parent().siblings().css('display','block');
			var dd = $(this);
			var as = $(this).parent().siblings().attr('as');
			if(as != 'as'){
				$('div.Tows').click(function(){
					dd.parent().siblings().css('display','none');
				});
				$('.sr').siblings().click(function(){
					dd.parent().siblings().css('display','none');
				});
				$('.srs').click(function(){
					dd.parent().siblings().css('display','none');
				});
			}
		});
		var riqi = $('div.riqi p');
		riqi.click(function(){
			//选取的值
			var values = $(this).text();
			$(this).parent().siblings().children('span').children('tt').text(values);
			$(this).parent().css('display','none').attr('as','as');
		});
		
		//性别单击事件
		var sexs = $('span.sexs');
		var sex = "1";
		sexs.click(function(){
			$(this).children(0).css('background-position','-17px 0');
			$(this).siblings().children(0).css('background-position','30px 0');
			sex = $(this).attr('value');
		});

		//页面加载完事件
		$(function($){
			var nan = $('i.nan');
			var nv = $('i.nv');
			//判断uid是否存在
			if("{$detection}" != "no"){
				if("{$users['sex']}" == "1"){
					nan.css('background-position','-17px 0');
				}else{
					nv.css('background-position','-17px 0');
				}
			}
		});

		var baocun = $('.baocun');
		baocun.click(function(){
			var usernames = $('#usernames').val();
			var years = $('#years').text();
			var months = $('#months').text();
			var days = $('#days').text();
			years = (years != "请选择") ? years : "2015";
			months = (months != "请选择") ? months : "01"; 
			days = (days != "请选择") ? days : "01"; 
			var birthdays = years+"-"+months+"-"+days;
			
			//判断是添加还是修改操作
			if("{$detection}" == "no"){
				location.href = "{:U('Home/AccountInfo/insert')}?name="+usernames+"&birthday="+birthdays+"&sex="+sex;
			}else{
				location.href = "{:U('Home/AccountInfo/update')}?name="+usernames+"&birthday="+birthdays+"&sex="+sex;
			}
		});


		
	
	</script>
	<!-- 编辑基础资料end -->

</body></html>